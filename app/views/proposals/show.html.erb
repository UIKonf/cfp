<% provide(:title, "#{@proposal.title}") %>

<% if @proposal.user.blocked %>
  <div class="alert alert-danger">
    This proposal has been removed by a moderator
  </div>
<% else %>
  <% if @proposal.user == current_user %>
    <div class="alert alert-secondary d-flex flex-row align-items-center">
      <div>
        You are the author of this proposal
      </div>
      <div class="ml-auto">
        <% if can?(:update, :proposal) %>
          <%= link_to 'Edit', edit_proposal_path(@proposal), class: 'btn btn-success' %>
        <% end %>
        <% if @proposal.can_withdraw? && can?(:withdraw, :proposal) %>
          <%= link_to 'Withdraw', withdraw_proposal_path(@proposal), method: :post, class: 'btn btn-danger', data: {confirm: 'Are you sure?'} %>
        <% elsif @proposal.can_publish? && can?(:publish, :proposal) %>
          <%= link_to 'Publish', publish_proposal_path(@proposal), method: :post, class: 'btn btn-warning', data: {confirm: 'Are you sure?'} %>
        <% end %>
      </div>
    </div>
  <% end %>

  <% if @proposal.withdrawn? %>
    <div class="alert alert-info" role="alert">
      This proposal has been withdrawn
    </div>
  <% end %>

  <div class="row">
    <div class="col-sm-8">
      <h1>
        <%= @proposal.title %>

        <% if @proposal.user == current_user %>
        <% end %>
      </h1>

      <%= markdown(@proposal.description) %>
    </div>
    <div class="col-sm-4">
      <% if show_comments?(@proposal) %>
        <h2>Comments</h2>
        <%= render partial: 'comments/comment', collection: @proposal.comments, locals: {author: @proposal.user} %>

        <% if can?(:create, :comment) %>
          <%= render 'comments/form' %>
        <% end %>
      <% end %>
    </div>
  </div>
<% end %>

